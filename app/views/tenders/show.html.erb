<script src="http://code.highcharts.com/highcharts.js"></script>
<div class="tender-detail">
	<h3> <%= @tender.name %></h3>
	<div class="clear10"></div>
	<%= raw(@tender.description)  %>
	<div class="clear10"></div>
	<form>
		<div class="form-wrapper tend-detail">
			<div class="form-row">
				<div class="label">
					Open Date
				</div>
				<div class="field">
					<div>
						<%= @tender.open_date.strftime('%b %e, %l:%M %p') rescue "" %>
					</div>
				</div>
				<div class="clear"></div>
			</div>
			<div class="form-row">
				<div class="label">
					Close Date
				</div>
				<div class="field">
					<div>
						<%= @tender.close_date.strftime('%b %e, %l:%M %p') rescue "" %>
					</div>
				</div>
				<div class="clear"></div>
			</div>
			<div class="form-row">
				<div class="label">
					Status
				</div>
				<div class="field">
					<% if @tender.open? %>
					<span class="stat-open">Open</span>
					<% else %>
					<span class="stat-close">Closed</span>
					<% end %>
				</div>
				<div class="clear"></div>
			</div>
		</div>
	</form>
	<div class="clear"></div>
	<% if @tender.open? or current_admin %>
	
	<div class="table">
		<h2>Stone details :</h2>
		<p>Round: <%= @round+1%> Ends in </p>
		<p id="timer"></p>
		<div class="form-wrapper bid-info">

 			<div class='stone_filter'>
				<%= render 'stone_filter' %>
			</div> 
			<% unless @tender.stones.length == 0%>
			<div class='stone_list'>
				<%= render :partial => "graph" unless @last_tender.nil? or @diff.length == 0 %>
				<%= render 'stone_bids' %>
			</div>
			<% else %>
			<p class="center">Tender details not uploaded.</p>
			<% end %>

			<%# if @tender.open? %>
			<%#= render 'bids/form' %>
			<%# else %>
			<%#= render 'bids/details' %>
			<%# end %>

		</div>

		<div class="bid-info bid_form" style="width:80%!important; margin-left:-10px; display:none">

		</div>
		
		<div class="bid-info past_result" style="width:40%!important; margin-left:20px; display:none">

		</div>

	</div>
	<% end %>
</div>
<div class="clear"></div>
<script>
	$(document).ready(function() {
		$("#myTable").tablesorter();
	});

 function countdown() {
    var seconds = 30;
    function tick() {
        var counter = document.getElementById("timer");
        seconds--;
        counter.innerHTML = "0:" + (seconds < 10 ? "0" : "") + String(seconds);
        if( seconds > 0 ) {
            setTimeout(tick, 1000);
        } else {
          $.ajax({
          	url: "/tenders/<%= @tender.id%>/next_round?round=<%= @round %>"
          })
          window.location.reload(true);
        }
    }
    tick();
}

countdown();
</script>
<style type="text/css">
	#timer{
		border: 2px solid #808080;
		float: right;
		font-size: 18px;
	}
</style>

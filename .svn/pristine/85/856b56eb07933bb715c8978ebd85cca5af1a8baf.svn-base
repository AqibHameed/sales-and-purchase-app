class Stone < ActiveRecord::Base

  attr_accessible :stone_type, :no_of_stones, :weight, :carat, :purity, :color, :polished, :size,
                  :deec_no, :lot_no, :description#, :tender_id

  has_many :bids
  has_one :winner

#  validates_presence_of :stone_type

  validates_numericality_of :no_of_stones, :weight, :carat, :allow_blank => true

  belongs_to :tender

  def per_carat_bid(customer)
    bid = self.bids.find_by_customer_id(customer.id)
    bid.blank? ? '' : bid.price_per_carat
  end

  def total_bid(customer)
    bid = self.bids.find_by_customer_id(customer.id)
    bid.blank? ? '' : bid.total
  end

  def name
    self.lot_no.blank? ? "stone #{self.id}" : self.lot_no
  end

  def top_three_bids
    self.bids.order('total desc').limit(3)
  end

  rails_admin do
    edit do
      field :stone_type, :enum do
        enum do
          ['Stone', 'Parcel']
        end
      end
      [:deec_no, :lot_no, :description, :no_of_stones, :weight].each do |field_name|
        field field_name
      end
    end
  end

end

